{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://jen.dev/schemas/ro-crate/jen-rcp-1.0.json",
  "title": "JEN RO-Crate Profile (JEN-ROCP-1.0)",
  "description": "Profile for Journal of Executable Neuroscience reproducibility bundles. This schema validates a profile manifest (jen-rocp.json) that accompanies a standard RO-Crate (ro-crate-metadata.json). It ensures presence and structure of required components for operational reproducibility including configuration, data, environment, execution, raw artifacts, visualization mapping, provenance/attestations, and optional hardware manifests.",
  "type": "object",
  "required": ["schemaVersion", "bundle", "configuration", "data", "environment", "rawArtifacts", "visualization", "execution", "provenance", "identifiers", "compliance"],
  "properties": {
    "schemaVersion": {
      "type": "string",
      "const": "JEN-ROCP-1.0"
    },
    "bundle": {
      "type": "object",
      "required": ["title", "abstract", "version", "keywords", "license", "contributors", "created", "digest"],
      "properties": {
        "title": { "type": "string", "minLength": 3 },
        "abstract": { "type": "string", "minLength": 20 },
        "version": { "type": "string", "minLength": 1 },
        "keywords": {
          "type": "array",
          "minItems": 1,
          "items": { "type": "string", "minLength": 1 }
        },
        "license": {
          "type": "string",
          "description": "SPDX license identifier covering the bundle manifest and metadata.",
          "minLength": 3
        },
        "contributors": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["name"],
            "properties": {
              "name": { "type": "string" },
              "orcid": {
                "type": "string",
                "pattern": "^https?://orcid\\.org/\\d{4}-\\d{4}-\\d{4}-\\d{3}[\\dX]$"
              },
              "affiliation": { "type": "string" },
              "role": { "type": "string" }
            },
            "additionalProperties": false
          }
        },
        "affiliations": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name"],
            "properties": {
              "name": { "type": "string" },
              "ror": {
                "type": "string",
                "pattern": "^https?://ror\\.org/[a-h0-9]{9}$"
              }
            },
            "additionalProperties": false
          }
        },
        "funders": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name"],
            "properties": {
              "name": { "type": "string" },
              "grantId": { "type": "string" }
            },
            "additionalProperties": false
          }
        },
        "relatedIdentifiers": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["relationType", "identifier"],
            "properties": {
              "relationType": {
                "type": "string",
                "enum": [
                  "IsSupplementTo",
                  "IsReferencedBy",
                  "IsPartOf",
                  "Cites",
                  "IsDerivedFrom",
                  "IsNewVersionOf"
                ]
              },
              "identifier": { "type": "string", "minLength": 3 }
            },
            "additionalProperties": false
          }
        },
        "digest": {
          "type": "object",
          "description": "Content-addressed digest for the bundle archive (e.g., SHA-256).",
          "required": ["algo", "value"],
          "properties": {
            "algo": { "type": "string", "enum": ["sha256", "sha512"] },
            "value": { "type": "string", "pattern": "^[a-fA-F0-9]{64,128}$" }
          },
          "additionalProperties": false
        },
        "created": { "type": "string", "format": "date-time" }
      },
      "additionalProperties": false
    },
    "configuration": {
      "type": "object",
      "required": ["primary", "files"],
      "properties": {
        "primary": { "type": "string", "description": "Path to primary config used for triage (e.g., params.toml)" },
        "files": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["path"],
            "properties": {
              "path": { "type": "string", "minLength": 1 },
              "seeds": {
                "type": "object",
                "description": "Declared random seeds by framework/library.",
                "additionalProperties": { "type": "integer" }
              },
              "hyperparameters": {
                "type": "object",
                "description": "Key scientific parameters; free-form key/value."
              },
              "datasets": {
                "type": "array",
                "items": { "type": "string", "minLength": 1 },
                "description": "References to data.sources[].id"
              }
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    },
    "data": {
      "type": "object",
      "required": ["sources"],
      "properties": {
        "sources": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["id", "access", "integrity"],
            "properties": {
              "id": { "type": "string", "minLength": 1 },
              "type": {
                "type": "string",
                "enum": ["embedded", "remote"]
              },
              "doi": {
                "type": "string",
                "pattern": "^10\\.\\d{4,9}/[-._;()/:A-Z0-9]+$",
                "description": "DataCite/Crossref DOI for external data"
              },
              "access": {
                "type": "object",
                "required": ["uri"],
                "properties": {
                  "uri": { "type": "string", "minLength": 3 },
                  "license": { "type": "string", "minLength": 3 },
                  "terms": { "type": "string" }
                },
                "additionalProperties": false
              },
              "integrity": {
                "type": "object",
                "required": ["algo", "value"],
                "properties": {
                  "algo": { "type": "string", "enum": ["sha256", "sha512"] },
                  "value": { "type": "string", "pattern": "^[a-fA-F0-9]{64,128}$" }
                },
                "additionalProperties": false
              },
              "sizeBytes": { "type": "integer", "minimum": 0 }
            },
            "additionalProperties": false
          }
        },
        "fetch": {
          "type": "object",
          "properties": {
            "scripts": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Non-interactive, idempotent data retrieval scripts"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "environment": {
      "type": "object",
      "required": ["dockerfilePath", "imageDigest", "baseImage", "locks", "sbom"],
      "properties": {
        "dockerfilePath": { "type": "string" },
        "imageDigest": {
          "type": "string",
          "pattern": "^sha256:[a-f0-9]{64}$"
        },
        "baseImage": {
          "type": "object",
          "required": ["name", "digest"],
          "properties": {
            "name": { "type": "string" },
            "digest": { "type": "string", "pattern": "^sha256:[a-f0-9]{64}$" }
          },
          "additionalProperties": false
        },
        "locks": {
          "type": "object",
          "description": "One or more lockfiles for deterministic rebuilds.",
          "properties": {
            "conda": { "type": "string" },
            "nix": { "type": "string" },
            "pip": { "type": "string" },
            "osPackages": { "type": "string" }
          },
          "additionalProperties": false
        },
        "drivers": {
          "type": "object",
          "properties": {
            "cuda": { "type": "string" },
            "rocm": { "type": "string" },
            "vendorSDKs": {
              "type": "array",
              "items": { "type": "string" }
            }
          },
          "additionalProperties": false
        },
        "sbom": {
          "type": "object",
          "required": ["format", "path"],
          "properties": {
            "format": { "type": "string", "enum": ["SPDX-2.3", "CycloneDX-1.5", "CycloneDX-1.6"] },
            "path": { "type": "string" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "rawArtifacts": {
      "type": "object",
      "required": ["index"],
      "properties": {
        "index": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["path", "checksum", "mimeType"],
            "properties": {
              "path": { "type": "string" },
              "checksum": {
                "type": "object",
                "required": ["algo", "value"],
                "properties": {
                  "algo": { "type": "string", "enum": ["sha256", "sha512"] },
                  "value": { "type": "string", "pattern": "^[a-fA-F0-9]{64,128}$" }
                },
                "additionalProperties": false
              },
              "sizeBytes": { "type": "integer", "minimum": 0 },
              "mimeType": { "type": "string" },
              "description": { "type": "string" }
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    },
    "visualization": {
      "type": "object",
      "required": ["figures"],
      "properties": {
        "figures": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "script", "inputs", "output"],
            "properties": {
              "id": { "type": "string" },
              "script": { "type": "string", "description": "Path to regeneration script/tool entrypoint" },
              "inputs": {
                "type": "array",
                "items": { "type": "string" }
              },
              "output": { "type": "string" },
              "params": { "type": "object" }
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    },
    "execution": {
      "type": "object",
      "required": ["command", "configPath", "resources", "expectedExitCode"],
      "properties": {
        "command": { "type": "string", "minLength": 1, "description": "Single canonical triage command (e.g., snn train --config params.toml)" },
        "configPath": { "type": "string" },
        "resources": {
          "type": "object",
          "required": ["cpu", "memoryGB", "timeLimitMinutes"],
          "properties": {
            "cpu": { "type": "number", "minimum": 0.1 },
            "memoryGB": { "type": "number", "minimum": 0.5 },
            "gpu": {
              "type": "object",
              "properties": {
                "count": { "type": "integer", "minimum": 0 },
                "type": { "type": "string" }
              },
              "additionalProperties": false
            },
            "accelerator": {
              "type": "object",
              "properties": {
                "type": { "type": "string", "enum": ["TPU", "NPU", "Loihi", "SpiNNaker", "FPGA", "ASIC", "None"] },
                "count": { "type": "integer", "minimum": 0 }
              },
              "additionalProperties": false
            },
            "timeLimitMinutes": { "type": "integer", "minimum": 1 }
          },
          "additionalProperties": false
        },
        "expectedExitCode": { "type": "integer", "enum": [0] }
      },
      "additionalProperties": false
    },
    "provenance": {
      "type": "object",
      "required": ["attestations"],
      "properties": {
        "graph": {
          "type": "object",
          "description": "Optional summary linking artifacts, executions, and derived outputs"
        },
        "attestations": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["type", "path"],
            "properties": {
              "type": { "type": "string", "enum": ["build", "rerun", "reproduction", "sensitivity", "hardware-parity"] },
              "path": { "type": "string" },
              "signaturePath": { "type": "string" },
              "transparencyLog": { "type": "string" }
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    },
    "hardware": {
      "type": "object",
      "description": "Required only when neuromorphic/HPC hardware is used",
      "required": ["vendor", "model", "firmware", "schedulerJobId"],
      "properties": {
        "vendor": { "type": "string", "enum": ["Intel", "Manchester", "Heidelberg", "Custom", "Other"] },
        "model": { "type": "string", "minLength": 1 },
        "deviceIds": {
          "type": "array",
          "items": { "type": "string" }
        },
        "firmware": { "type": "string" },
        "schedulerJobId": { "type": "string" },
        "site": { "type": "string" },
        "capabilities": {
          "type": "object",
          "properties": {
            "spikePrecision": { "type": "string" },
            "supportedModels": {
              "type": "array",
              "items": { "type": "string" }
            },
            "determinism": { "type": "string", "enum": ["deterministic", "nondeterministic", "bounded"] }
          },
          "additionalProperties": false
        },
        "context": {
          "type": "object",
          "properties": {
            "clock": { "type": "string" },
            "temperatureC": { "type": "number" },
            "topology": { "type": "string" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "identifiers": {
      "type": "object",
      "required": ["bundleDOI"],
      "properties": {
        "bundleDOI": {
          "type": "string",
          "pattern": "^10\\.\\d{4,9}/[-._;()/:A-Z0-9]+$"
        },
        "paperDOI": {
          "type": "string",
          "pattern": "^10\\.\\d{4,9}/[-._;()/:A-Z0-9]+$"
        },
        "orcids": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^https?://orcid\\.org/\\d{4}-\\d{4}-\\d{4}-\\d{3}[\\dX]$"
          }
        }
      },
      "additionalProperties": false
    },
    "compliance": {
      "type": "object",
      "required": ["codeLicense", "dataLicense", "exportControl", "ethics"],
      "properties": {
        "codeLicense": { "type": "string", "description": "SPDX identifier for code" },
        "dataLicense": { "type": "string", "description": "License or terms for data" },
        "exportControl": {
          "type": "object",
          "required": ["flag"],
          "properties": {
            "flag": { "type": "boolean" },
            "notes": { "type": "string" }
          },
          "additionalProperties": false
        },
        "ethics": {
          "type": "object",
          "properties": {
            "humanSubjects": { "type": "boolean" },
            "animalSubjects": { "type": "boolean" },
            "statements": { "type": "string" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "allOf": [
    {
      "if": { "required": ["hardware"] },
      "then": {
        "properties": {
          "hardware": {
            "required": ["vendor", "model", "firmware", "schedulerJobId"]
          }
        }
      }
    }
  ],
  "additionalProperties": false
}